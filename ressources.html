<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ressources â€” Cours de FranÃ§ais</title>
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    .res-hero{padding:36px 0;border-bottom:1px solid rgba(148,163,184,.12);
      background:linear-gradient(90deg, rgba(91,156,255,.18), rgba(168,85,247,.18))}
    .res-hero h2{margin:0;color:#fff}
    .res-hero .small{color:#e5e7eb}

    .res-wrap{display:grid;gap:24px;align-items:start}
    @media(min-width:1280px){.res-wrap{grid-template-columns:280px 1fr 420px}}
    @media(min-width:980px) and (max-width:1279px){.res-wrap{grid-template-columns:260px 1fr}}

    .toc{position:sticky;top:80px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid rgba(148,163,184,.15);border-radius:16px;padding:14px}
    .toc a{display:block;color:#cbd5e1;padding:6px 8px;border-radius:10px}
    .toc a:hover,.toc a.active{background:rgba(148,163,184,.1);color:#fff}

    .search{display:flex;gap:10px;align-items:center}
    .search input{width:100%;padding:12px;border:1px solid rgba(148,163,184,.25);border-radius:12px;background:rgba(255,255,255,.03);color:#fff}

    .accordion{display:grid;gap:12px}
    .acc{border:1px solid rgba(148,163,184,.2);border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02))}
    .acc-hd{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;cursor:pointer}
    .acc-hd h3{margin:0;font-size:18px;color:#fff;display:flex;align-items:center;gap:10px}
    .acc-hd .chev{transition:transform .2s ease}
    .acc.open .acc-hd .chev{transform:rotate(90deg)}
    .acc-bd{display:none;padding:0 14px 14px}
    .acc.open .acc-bd{display:block}

    .sub{border:1px dashed rgba(148,163,184,.25);border-radius:12px;padding:12px;margin:12px 0;background:rgba(255,255,255,.03)}
    .sub h4{margin:0 0 8px;font-size:16px;color:#e2e8f0;display:flex;align-items:center;gap:8px}
    .sub .items{display:grid;gap:10px}

    .fiche{border:1px solid rgba(148,163,184,.22);border-radius:12px;padding:12px;background:rgba(255,255,255,.02);display:grid;gap:6px}
    .fiche h5{margin:0;font-size:15px;color:#fff;display:flex;align-items:center;gap:8px}
    .fiche .small{color:#94a3b8}
    .fiche .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}
    .btn-mini{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;font-weight:700;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.03);color:#e2e8f0;cursor:pointer}
    .btn-mini:hover{filter:brightness(1.06)}
    .badge-k{display:inline-block;margin-left:8px;padding:3px 8px;border:1px solid rgba(148,163,184,.25);border-radius:999px;font-size:12px;color:#cbd5e1}

    .viewer-col{display:none}
    @media(min-width:1280px){.viewer-col{display:block; position:sticky; top:80px}}
    .viewer{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid rgba(148,163,184,.15);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.22);padding:16px;height:max(60vh, 480px);overflow:auto}
    .viewer h4{margin:4px 0 8px}
    .viewer .meta{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}
    .viewer .meta .chip{font-size:12px;border:1px solid rgba(148,163,184,.25);border-radius:999px;padding:4px 8px;color:#cbd5e1}
    .viewer .ex{background:#0f172a;border:1px dashed rgba(148,163,184,.28);border-radius:10px;padding:10px;margin-top:8px}
    .viewer-empty{color:#94a3b8}

    .drawer{position:fixed;inset:0;display:none}
    .drawer.open{display:block}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .drawer .panel{position:absolute;inset:auto 0 0 0;background:#0f172a;border-top:1px solid rgba(148,163,184,.2);border-radius:18px 18px 0 0;max-height:85vh;overflow:auto;box-shadow:0 -8px 24px rgba(0,0,0,.35);padding:14px}
    .drawer .close{position:sticky;top:0;display:flex;justify-content:flex-end}
    .drawer .close button{margin:-6px -6px 6px 0}
    .focus-ring:focus{outline:2px solid rgba(91,156,255,.6);outline-offset:2px;border-radius:10px}
  </style>
</head>
<body>
<header>
  <nav class="container">
    <div class="brand">
      <svg class="flag" viewBox="0 0 3 2" aria-hidden="true"><rect width="1" height="2" x="0" fill="#002395"/><rect width="1" height="2" x="1" fill="#ffffff"/><rect width="1" height="2" x="2" fill="#ED2939"/></svg>
      <h1>Cours de FranÃ§ais â€” Domingas Silva</h1>
    </div>
    <button class="burger" aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="navlinks">â˜°</button>
    <div class="navlinks" id="navlinks">
      <a href="index.html">Accueil</a>
      <a href="apropos.html">Ã€ propos</a>
      <a href="cours.html">Cours</a>
      <a class="active" href="ressources.html">Ressources</a>
      <a href="contact.html">Contact</a>
      <a class="btn btn-primary" href="contact.html#inscription">Sâ€™inscrire</a>
    </div>
  </nav>
</header>

<main class="res-hero">
  <div class="container">
    <h2>Ressources de cours</h2>
    <p class="small">Parcourez les thÃ¨mes, puis ouvrez chaque fiche dans le <strong>volet de lecture</strong> (droite) ou en <strong>slide-over</strong> sur mobile.</p>
  </div>
</main>

<section class="container res-wrap">
  <aside class="toc">
    <div class="card">
      <strong>Sommaire</strong>
      <div id="toc-links" style="margin-top:10px"></div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="search">
        <input id="search" type="search" placeholder="Rechercher (ex : imparfait, adjectifs, paysâ€¦)">
      </div>
      <div class="small" style="margin-top:6px;color:#94a3b8">Filtre les sections et fiches. Appuie sur EntrÃ©e pour valider.</div>
    </div>
  </aside>

  <div>
    <div id="acc-container" class="accordion"></div>
  </div>

  <aside class="viewer-col">
    <div class="viewer" id="viewer">
      <div class="viewer-empty">SÃ©lectionnez une fiche dans la liste Ã  gauche.</div>
    </div>
  </aside>
</section>

<div class="drawer" id="drawer" aria-hidden="true">
  <div class="backdrop" data-dismiss></div>
  <div class="panel">
    <div class="close"><button class="btn-mini" data-dismiss>Fermer âœ–</button></div>
    <div id="drawer-content"></div>
  </div>
</div>

<footer>
  <div class="container footer-inner">
    <div class="small">Â© <span id="year"></span> Domingas Silva â€” Ressources pÃ©dagogiques.</div>
  </div>
</footer>

<script>
  // IcÃ´nes
  const I = {
    grammaire:'ğŸ“˜', temps:'â±ï¸', present:'ğŸŸ¢', passe:'ğŸ•°ï¸', futur:'â­ï¸', conditionnel:'ğŸ¤', irreg:'ğŸ§©',
    verbes:'ğŸ”¤', conjugueur:'ğŸ§®', noms:'ğŸ·ï¸', articles:'ğŸ“°', pronoms:'ğŸ‘¥', adjectifs:'ğŸ¨', adverbes:'ğŸƒ', preps:'ğŸ§­', phrase:'ğŸ§±',
    vocab:'ğŸ—‚ï¸', confondre:'âš ï¸', conj:'ğŸ”—', nombres:'ğŸ”¢', pays:'ğŸŒ', expressions:'ğŸ’¬', thematique:'ğŸ§©', calendrier:'ğŸ—“ï¸',
    comprehension:'ğŸ‘‚ğŸ“–', ecrite:'ğŸ“„', orale:'ğŸ§', ecriture:'âœï¸', ponctuation:'âœ´ï¸', figures:'âœ¨', pov:'ğŸ‘ï¸', registres:'ğŸ­', image:'ğŸ–¼ï¸'
  };

  // ===================== DONNÃ‰ES COMPLÃˆTES (fiches) =====================
  const DATA = [
    {
      id:'grammaire', title:`${I.grammaire} Grammaire`,
      groups: [
        { title:`${I.temps} Temps de lâ€™indicatif`, items:[
          { title:`${I.present} PrÃ©sent`, fiches:[
              { title:'Valeurs & formation',
                html:`<p>Le <strong>prÃ©sent de lâ€™indicatif</strong> exprime une action en cours, une vÃ©ritÃ© gÃ©nÃ©rale ou un futur proche.</p>
                      <ul class="small"><li><strong>-ER</strong> : parler â†’ je parle, tu parles, il parle, nous parlons, vous parlez, ils parlent</li>
                      <li><strong>-IR</strong> : finir â†’ je finis, ... nous finissons, vous finissez, ils finissent</li>
                      <li><strong>-RE</strong> : vendre â†’ je vends, tu vends, il vend, nous vendons, vous vendez, ils vendent</li></ul>
                      <div class="ex"><strong>Exercice</strong> : Conjuguez au prÃ©sent : Â« nous (visiter) Â», Â« ils (choisir) Â».
                        <details><summary>Correction</summary><div>nous visitons ; ils choisissent</div></details></div>`},
              { title:'PrÃ©sent vs futur proche',
                html:`<p>Le <em>futur proche</em> : <strong>aller + infinitif</strong> (<em>je vais partir</em>) pour un futur imminent, planifiÃ©.</p>
                      <div class="ex"><strong>Exercice</strong> : Transformez au futur proche : Â« Je dÃ®ne. Â» â†’ â€¦
                        <details><summary>Correction</summary><div>Je <strong>vais dÃ®ner</strong>.</div></details></div>`}
          ]},
          { title:`${I.passe} PassÃ© composÃ©`, fiches:[
              { title:'Formation AVOIR/ÃŠTRE + participe',
                html:`<p>Le <strong>passÃ© composÃ©</strong> = <em>auxiliaire (avoir/Ãªtre) au prÃ©sent</em> + <em>participe passÃ©</em>.</p>
                      <ul class="small"><li>Avec <strong>Ãªtre</strong> (aller, venir, naÃ®tre, mourir, monterâ€¦) : accord avec le sujet. <em>Elle est allÃ©e</em>.</li>
                      <li>Avec <strong>avoir</strong> : accord avec COD <em>placÃ© avant</em>. <em>Les fleurs quâ€™elle a achet<span style="text-decoration:underline">Ã©es</span></em>.</li></ul>
                      <div class="ex"><strong>Exercice</strong> : Â« Elles (arriver) Â» ; Â« Il a (manger) les pommes. Â»
                        <details><summary>Correction</summary><div>Elles <strong>sont arrivÃ©es</strong> ; Il <strong>a mangÃ©</strong> les pommes.</div></details></div>`},
              { title:'Valeurs & emploi',
                html:`<p>Action terminÃ©e, datÃ©e, avancÃ©e du rÃ©cit : <em>Hier, jâ€™ai fini le dossier.</em></p>`}
          ]},
          { title:`${I.passe} Imparfait / PassÃ© composÃ©`, fiches:[
              { title:'Contraste narratif',
                html:`<p><strong>Imparfait</strong> = dÃ©cor, habitude, description ; <strong>PassÃ© composÃ©</strong> = actions qui font avancer lâ€™histoire.</p>
                      <div class="ex"><strong>Choix</strong> : Â« Je (lire) quand il (sonner). Â»
                        <details><summary>Correction</summary><div>Je <strong>lisais</strong> quand il <strong>a sonnÃ©</strong>.</div></details></div>`}
          ]},
          { title:`${I.futur} Futur simple & antÃ©rieur`, fiches:[
              { title:'Terminaisons & orthographe',
                html:`<p>Futur simple : <em>parlerai, finiras, ira</em>. Attention aux bases : <em>voir â†’ je verrai</em>.</p>
                      <div class="ex"><strong>Exercice</strong> : Futur de Â« nous (pouvoir) Â» ; Â« elle (voir) Â».
                        <details><summary>Correction</summary><div>nous <strong>pourrons</strong> ; elle <strong>verra</strong>.</div></details></div>`},
              { title:'Futur antÃ©rieur (valeurs)',
                html:`<p>Action <em>achevÃ©e dans le futur</em> avant une autre : Â« Quand tu arriveras, jâ€™<strong>aurai fini</strong>. Â»</p>`}
          ]},
          { title:`${I.conditionnel} Conditionnel`, fiches:[
              { title:'Politesse & hypothÃ¨se',
                html:`<p><strong>Conditionnel prÃ©sent</strong> : <em>je voudrais, nous aimerions</em>. Sert Ã  la politesse et aux hypothÃ¨ses.</p>
                      <div class="ex"><strong>ComplÃ©tez</strong> : Â« Je (aimer) un cafÃ©, sâ€™il vous plaÃ®t. Â»
                        <details><summary>Correction</summary><div>Je <strong>voudrais</strong> un cafÃ©.</div></details></div>`}
          ]},
          { title:`${I.irreg} Verbes irrÃ©guliers`, fiches:[
              { title:'ÃŠtre/Avoir/Aller/Faire',
                html:`<ul class="small"><li><strong>Ãªtre</strong> : je suis, tu es, il est, nous sommes...</li>
                      <li><strong>avoir</strong> : jâ€™ai, tu as, il a...</li>
                      <li><strong>aller</strong> : je vais, tu vas, il va...</li>
                      <li><strong>faire</strong> : je fais, tu fais, il fait...</li></ul>
                      <div class="ex"><strong>Exercice</strong> : Conjuguez Â« aller Â» (nous) au prÃ©sent.
                        <details><summary>Correction</summary><div>Nous <strong>allons</strong>.</div></details></div>`}
          ]}
        ]},
        { title:`${I.verbes} Verbes`, items:[
          { title:`${I.conjugueur} Conjugueur`, fiches:[
              { title:'Chercher un verbe',
                html:`<p class="small">Astuce : tapez Â« verbe + conjugaison Â» dans la recherche du site (module interne Ã  venir).</p>`}
          ]}
        ]},
        { title:`${I.noms} Noms & groupes nominaux`, items:[
          { title:`${I.articles} Articles`, fiches:[
              { title:'DÃ©fini / indÃ©fini / partitif',
                html:`<p><strong>le, la, les</strong> ; <strong>un, une, des</strong> ; <strong>du, de la, de lâ€™, des</strong>.</p>
                      <div class="ex"><strong>Choisissez</strong> : Â« ___ eau Â», Â« ___ pommes Â», Â« ___ sucre Â».
                        <details><summary>Correction</summary><div><strong>de lâ€™</strong> eau ; <strong>des</strong> pommes ; <strong>du</strong> sucre.</div></details></div>`}
          ]},
          { title:`${I.pronoms} DÃ©terminants & pronoms`, fiches:[
              { title:'Possessifs / dÃ©monstratifs / relatifs',
                html:`<p><strong>mon/ma/mes</strong>, <strong>ce/cet/cette/ces</strong>, relatifs : <strong>qui/que/oÃ¹/dont</strong>.</p>`}
          ]},
          { title:`${I.adjectifs} Adjectifs`, fiches:[
              { title:'Accords & place',
                html:`<p>Accord en genre/nombre. Place <em>avant</em> pour certains (beau, grand, petitâ€¦).</p>
                      <div class="ex"><strong>Exercice</strong> : Â« des robes (bleu) Â» â†’ â€¦
                        <details><summary>Correction</summary><div>des robes <strong>bleues</strong>.</div></details></div>`}
          ]},
          { title:`${I.adverbes} Adverbes`, fiches:[
              { title:'Formation en -ment',
                html:`<p>Adjectif fÃ©m. + <strong>-ment</strong> : <em>heureux â†’ heureusement</em>.</p>`}
          ]},
          { title:`${I.preps} PrÃ©positions`, fiches:[
              { title:'Ã€ / De / En / Dans',
                html:`<p><strong>En</strong> + pays fÃ©m./voyelle ; <strong>au</strong> + pays masc. ; <strong>aux</strong> + pluriel. <em>En France</em>, <em>au BrÃ©sil</em>, <em>aux Ã‰tats-Unis</em>.</p>`}
          ]},
          { title:`${I.phrase} Structure de la phrase`, fiches:[
              { title:'SVO / nÃ©gation / interrogation',
                html:`<p>FranÃ§ais : <strong>Sujetâ€“Verbeâ€“Objets</strong>. NÃ©gation : <em>ne â€¦ pas</em>. Interrogation : <em>Est-ce queâ€¦</em></p>`}
          ]}
        ]}
      ]
    },
    {
      id:'vocabulaire', title:`${I.vocab} Vocabulaire`,
      groups: [
        { title:`${I.confondre} Mots Ã  ne pas confondre`, items:[
          { title:'Homophones', fiches:[
              { title:'a/Ã  ; ou/oÃ¹ ; ces/ses',
                html:`<p><strong>a/Ã </strong> : verbe/lieu ; <strong>ou/oÃ¹</strong> : choix/lieu ; <strong>ces/ses</strong> : dÃ©monstratif/possession.</p>
                      <div class="ex"><strong>ComplÃ©tez</strong> : Â« Il <em>__</em> faim Â», Â« Tu vas <em>__</em> Paris ? Â»
                        <details><summary>Correction</summary><div>a ; Ã </div></details></div>`}
          ]}
        ]},
        { title:`${I.conj} Conjonctions`, items:[
          { title:'Coordination / subordination', fiches:[
              { title:'mais, ou, etâ€¦ / parce que, lorsqueâ€¦',
                html:`<p>Reliez deux propositions : <em>Je viens <strong>parce que</strong> tu mâ€™as invitÃ©(e).</em></p>`}
          ]}
        ]},
        { title:`${I.nombres} Nombres, date et heure`, items:[
          { title:'Chiffres & dates', fiches:[
              { title:'Heure & formats',
                html:`<p><strong>Il est</strong> 7h30 ; le <strong>15/09/2025</strong> ; Â« <em>Nous sommes le</em> â€¦ Â».</p>`}
          ]}
        ]},
        { title:`${I.pays} Pays et gentilÃ©s`, items:[
          { title:'Cartes & listes', fiches:[
              { title:'NationalitÃ©s',
                html:`<p>France â†’ franÃ§ais(e) ; BrÃ©sil â†’ brÃ©silien(ne) ; Portugal â†’ portugais(e)â€¦</p>`}
          ]}
        ]},
        { title:`${I.expressions} Expressions`, items:[
          { title:'Idiomes courants', fiches:[
              { title:'Avoir besoin de / Ãªtre en retardâ€¦',
                html:`<p><em>Jâ€™ai besoin de</em> repos ; <em>Je suis en retard</em> ; <em>Ã‡a marche !</em></p>`}
          ]}
        ]},
        { title:`${I.thematique} Vocabulaire thÃ©matique`, items:[
          { title:'Vie quotidienne', fiches:[
              { title:'Alimentation / SantÃ© / Transports',
                html:`<ul class="small"><li>Alimentation : <em>le marchÃ©, cuisiner, goÃ»ter</em></li>
                      <li>SantÃ© : <em>se soigner, une ordonnance</em></li>
                      <li>Transports : <em>un billet, la correspondance</em></li></ul>
                      <div class="ex"><strong>Associez</strong> : Â« gare â€” Â», Â« ordonnance â€” Â»
                        <details><summary>Correction</summary><div>gare â€” train ; ordonnance â€” mÃ©decin</div></details></div>`}
          ]}
        ]},
        { title:`${I.calendrier} Calendrier de vocabulaire`, items:[
          { title:'Programme 12 semaines', fiches:[
              { title:'Exemple S1â†’S3',
                html:`<p class="small">S1 : salutations ; S2 : famille ; S3 : ville/transportsâ€¦</p>`}
          ]}
        ]}
      ]
    },
    {
      id:'comprehension', title:`${I.comprehension} ComprÃ©hension Ã©crite et orale`,
      groups: [
        { title:`${I.ecrite} ComprÃ©hension Ã©crite`, items:[
          { title:'Textes graduÃ©s', fiches:[
              { title:'A1â€“A2 : Annonce simple',
                html:`<p><em>Texte :</em> Â« La mÃ©diathÃ¨que est ouverte du mardi au samedi. Â»</p>
                      <div class="ex"><strong>Question</strong> : Quel jour est-elle fermÃ©e ?
                        <details><summary>Correction</summary><div>Le dimanche et le lundi.</div></details></div>`}
          ]}
        ]},
        { title:`${I.orale} ComprÃ©hension orale`, items:[
          { title:'Audio & vidÃ©o', fiches:[
              { title:'Dialogues du quotidien',
                html:`<p class="small">En classe : Ã©coute guidÃ©e Â« Ã€ la boulangerie Â» (intention, prix, politesse).</p>`}
          ]}
        ]}
      ]
    },
    {
      id:'atelier', title:`${I.ecriture} Atelier dâ€™Ã©criture`,
      groups: [
        { title:`${I.ponctuation} La ponctuation`, items:[
          { title:'Signes & usages', fiches:[
              { title:', ; : â€¦ ! ?',
                html:`<p>Le <strong>;</strong> sÃ©pare deux phrases proches ; <strong>:</strong> introduit une explication ; <strong>â€¦</strong> effet dâ€™attente.</p>`}
          ]}
        ]},
        { title:`${I.figures} Figures de style`, items:[
          { title:'FrÃ©quentes', fiches:[
              { title:'Comparaison / mÃ©taphore / hyperbole',
                html:`<p><em>clair comme lâ€™eau</em> (comparaison), <em>ocÃ©an de papiers</em> (hyperbole).</p>`}
          ]}
        ]},
        { title:`${I.pov} Point de vue narratif`, items:[
          { title:'Focalisations', fiches:[
              { title:'Interne / externe / omniscient',
                html:`<p>Interne = pensÃ©e dâ€™un perso ; Externe = camÃ©ra objective ; Omniscient = tout savoir.</p>`}
          ]}
        ]},
        { title:`${I.registres} Les registres de langue`, items:[
          { title:'Soutenu / courant / familier', fiches:[
              { title:'Adapter au contexte',
                html:`<p><em>Je vous prie de</em> (soutenu) / <em>Merci de</em> (courant) / <em>Tu peux</em> (familier).</p>`}
          ]}
        ]},
        { title:`${I.image} DÃ©crire une image`, items:[
          { title:'MÃ©thode pas Ã  pas', fiches:[
              { title:'Observer â†’ nommer â†’ relier',
                html:`<p>1) Qui/quoi/oÃ¹ ? 2) Couleurs, positions, actions 3) HypothÃ¨ses, interprÃ©tation.</p>
                      <div class="ex"><strong>Exercice</strong> : DÃ©crivez une photo de classe (3 phrases).
                        <details><summary>Proposition</summary><div>On voit une prof devant le tableau. Les Ã©tudiants Ã©crivent. Lâ€™ambiance est studieuse.</div></details></div>`}
          ]}
        ]}
      ]
    }
  ];
  // ===================== FIN DES DONNÃ‰ES =====================

  const accRoot   = document.getElementById('acc-container');
  const tocRoot   = document.getElementById('toc-links');
  const searchEl  = document.getElementById('search');
  const viewerCol = document.querySelector('.viewer-col');
  const viewer    = document.getElementById('viewer');
  const drawer    = document.getElementById('drawer');
  const drawerCt  = document.getElementById('drawer-content');

  tocRoot.innerHTML = DATA.map(s=>`<a href="#${s.id}" data-id="${s.id}">${s.title}</a>`).join('');

  function render(filter=''){
    const q = (filter||'').trim().toLowerCase();
    accRoot.innerHTML = DATA.map((section, sIdx)=>{
      const groupsHTML = (section.groups||[]).map((g, gIdx)=>{
        const itemsHTML = (g.items||[]).map((it, iIdx)=>{
          const fiches = (it.fiches||[])
            .filter(f => !q || f.title.toLowerCase().includes(q) || (f.html && f.html.toLowerCase().includes(q)) || it.title.toLowerCase().includes(q))
            .map((f, fIdx)=>{
              const fid = encodeURIComponent(`${sIdx}|${gIdx}|${iIdx}|${fIdx}`);
              return `<div class="fiche">
                        <h5><span class="ico">ğŸ“„</span>${f.title}</h5>
                        <div class="small">${it.title} â€” ${g.title}</div>
                        <div class="actions">
                          <button class="btn-mini focus-ring" data-open="${fid}" aria-label="Ouvrir ${f.title}">Ouvrir dans le volet â†’</button>
                          <a class="btn-mini focus-ring" href="#view=${fid}" aria-label="Lien direct">Lien direct ğŸ”—</a>
                        </div>
                      </div>`;
            }).join('');
          if (!fiches) return '';
          return `<div class="sub">
                    <h4><span class="ico">ğŸ“š</span>${it.title}</h4>
                    <div class="items">${fiches}</div>
                  </div>`;
        }).join('');
        if (!itemsHTML.trim()) return '';
        return `<div class="card" style="padding:12px">${itemsHTML}</div>`;
      }).join('');
      if (!groupsHTML.trim()) return '';
      return `<div class="acc" id="${section.id}">
        <div class="acc-hd" role="button" aria-expanded="false">
          <h3>${section.title}</h3>
          <span class="badge-k">${(section.groups||[]).length} groupes</span>
          <span class="chev">â–¶</span>
        </div>
        <div class="acc-bd">${groupsHTML}</div>
      </div>`;
    }).join('');

    attachAccHandlers();
    attachOpenHandlers();
    restoreHash();
  }

  function attachAccHandlers(){
    accRoot.querySelectorAll('.acc').forEach(acc=>{
      const hd = acc.querySelector('.acc-hd');
      hd.addEventListener('click', ()=>{
        acc.classList.toggle('open');
        const open = acc.classList.contains('open');
        hd.setAttribute('aria-expanded', open?'true':'false');
        const key='acc-open';
        const set = new Set(JSON.parse(localStorage.getItem(key) || '[]'));
        open ? set.add(acc.id) : set.delete(acc.id);
        localStorage.setItem(key, JSON.stringify([...set]));
        history.replaceState(null,'',`#${acc.id}`);
      });
    });
  }
  function restoreAccOpen(){
    const key='acc-open';
    const open = new Set(JSON.parse(localStorage.getItem(key) || '[]'));
    open.forEach(id=>{
      const el=document.getElementById(id);
      if(el){ el.classList.add('open'); el.querySelector('.acc-hd')?.setAttribute('aria-expanded','true'); }
    });
  }

  function attachOpenHandlers(){
    accRoot.querySelectorAll('[data-open]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const fid = btn.getAttribute('data-open');
        openFicheById(fid, true);
      });
    });
  }

  function parseFid(fid){
    const [s,g,i,f] = decodeURIComponent(fid).split('|').map(n=>parseInt(n,10));
    const section = DATA[s]; if(!section) return null;
    const group   = section.groups?.[g]; if(!group) return null;
    const item    = group.items?.[i]; if(!item) return null;
    const fiche   = item.fiches?.[f]; if(!fiche) return null;
    return {section, group, item, fiche, indexes:{s,g,i,f}};
  }

  function renderFicheHTML({section, group, item, fiche}){
    return `<div class="meta">
              <span class="chip">${section.title}</span>
              <span class="chip">${group.title}</span>
              <span class="chip">${item.title}</span>
            </div>
            <h4>${fiche.title}</h4>
            <div>${fiche.html}</div>`;
  }

  function openFicheById(fid, pushHash=false){
    const p = parseFid(fid);
    if(!p) return;
    const html = renderFicheHTML(p);
    if (window.matchMedia('(min-width: 1280px)').matches) {
      document.querySelector('.viewer-col').style.display = 'block';
      viewer.innerHTML = html; viewer.scrollTop = 0;
    } else {
      drawerCt.innerHTML = html;
      drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
    }
    if (pushHash) location.hash = `view=${encodeURIComponent(fid)}`;
  }

  function restoreHash(){
    const h = location.hash.replace('#','');
    if(!h) return;
    if(h.startsWith('view=')){
      openFicheById(h.slice(5), false);
    } else {
      const el = document.getElementById(decodeURIComponent(h));
      if(el){
        el.classList.add('open');
        el.querySelector('.acc-hd')?.setAttribute('aria-expanded','true');
        setTimeout(()=>el.scrollIntoView({behavior:'smooth', block:'start'}), 50);
      }
    }
    syncTOC();
  }
  window.addEventListener('hashchange', restoreHash);

  function highlight(q){
    accRoot.querySelectorAll('.hit').forEach(el=>el.classList.remove('hit'));
    if(!q.trim()) return;
    const t = q.trim().toLowerCase();
    accRoot.querySelectorAll('.sub h4, .fiche h5, .acc-hd h3').forEach(el=>{
      if(el.textContent.toLowerCase().includes(t)){
        el.closest('.acc, .sub, .fiche')?.classList.add('hit');
        const acc = el.closest('.acc');
        if(acc){ acc.classList.add('open'); acc.querySelector('.acc-hd')?.setAttribute('aria-expanded','true'); }
      }
    });
  }
  searchEl.addEventListener('input', e=>{ render(e.target.value); highlight(e.target.value); });
  searchEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); highlight(searchEl.value||''); }});

  function syncTOC(){
    const hash = location.hash.replace('#','');
    tocRoot.querySelectorAll('a').forEach(a=>{
      a.classList.toggle('active', a.getAttribute('data-id')===hash);
    });
  }

  drawer.addEventListener('click', (e)=>{ if(e.target.hasAttribute('data-dismiss')){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); } });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); } });

  document.getElementById('year').textContent = new Date().getFullYear();
  render(''); restoreAccOpen(); syncTOC();
</script>
<script src="assets/script.js" defer></script>
</body>
</html>
